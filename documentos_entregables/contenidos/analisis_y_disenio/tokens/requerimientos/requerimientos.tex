%
% Requerimientos de tokens, análisis y diseño de generación de tokens.
% Proyecto Lovelace.
%

\subsection{Requerimientos}
\label{sec:requerimientos}

En \cite{pci_tokens}, el \gls{gl:pci} \gls{gl:ssc} divide a los
\glspl{gl:token} en reversibles e irreversibles. A su vez, los reversibles se
dividen en criptográficos y en no criptográficos; mientras que los
irreversibles se dividen en autenticables y no autenticables (figura
\ref{fig:division_tokens}).

\begin{figure}[H]
  \begin{center}
    \includegraphics[width=0.75\linewidth]
      {contenidos/analisis_y_disenio/tokens/requerimientos/diagramas/clasificacion.png}
    \caption{Clasificación de los \glspl{gl:token}.}
    \label{fig:division_tokens}
  \end{center}
\end{figure}

En esta sección se explica cada una de las categorías y se analizan los
requerimientos que deben tener. Para comenzar, se enlistan los requerimientos
aplicables a todos los \glspl{gl:token}, sin importar su categoría:

% GT1
\requerimiento[rq_pci:productos_de_hardware]
{Validación de productos de hardware}
{
  Si se usa un producto de hardware para la tokenización, este debe de ser
  validado por \gls{gl:fips} 140-2 nivel 3 o superior (descrito en
  \cite{nist_modulos_criptograficos}).
}

% GT2 se lo chutaron.
% GT3
\requerimiento[rq_pci:productos_de_software]
{Validación de productos de software}
{
  Si se usa un producto de software para la tokenización, este debe de ser
  validado por \gls{gl:fips} 140-2 nivel 2 o superior (descrito en
  \cite{nist_modulos_criptograficos}).
}

% GT4
\requerimiento[rq_pci:resistencia_texto_claro_conocido]
{Resistencia a texto claro conocido}
{
  Un atacante con acceso a múltiples pares de \glspl{gl:token} y
  \gls{gl:pan} no debe de ser capaz de determinar otros \gls{gl:pan} a partir
  de solamente \glspl{gl:token}. En otras palabras, los \glspl{gl:token}
  deben ser resistentes a ataques con texto en claro conocido (sección
  \ref{sec:criptoanalisis}).
}

% GT5
% Me parece que esto es reduntante: si GT4 ya estableció la necesidad de
% resistencia a texto claro conocido, la resistencia a sólo texto cifrado
% ya va incluida. De hecho, en la misma redacción de GT5 incluyen claramente
% a GT4 con una disyunción.
% Creo que ya había leído esto mismo en alguno de los artículos que nos pasó
% Sandra.
\requerimiento[rq_pci:resistencia_solo_texto_cifrado]
{Resistencia a sólo texto cifrado}
{
  Recuperar un \gls{gl:pan} a partir de un \gls{gl:token} debe de ser
  \gls{gl:computacionalmente_no_factible} (resistencia a ataques con sólo
  texto cifrado, sección \ref{sec:criptoanalisis}).
}

% GT6
\requerimiento[rq_pci:deteccion_anomalias]
{Detección de anomalías}
{
  Se deben de implementar disparadores que permitan detectar
  irregularidades en el sistema (anomalías, funcionamientos erróneos,
  comportamientos sospechosos). El producto debe registrar dichos eventos y
  avisar al personal correspondiente.
}

% GT7
\requerimiento[rq_pci:distincion_token_pan]
{Distinción entre \glspl{gl:token} y \gls{gl:pan}}
{
  Se debe contar con un mecanismo para distinguir entre \glspl{gl:token}
  y \gls{gl:pan}. Los proveedores del servicio de tokenización deben
  compartir este mecanismo con la entidad (o entidades) que usa los
  \glspl{gl:token}.
}

% GT8
\requerimiento[rq_pci:guia_de_instalacion]
{Guía de instalación}
{
  Se debe de contar con una guía de instalación y uso para el correcto
  funcionamiento del producto de tokenización.
}

% GT9
\requerimiento[rq_pci:integridad_ejecutables]
{Integridad del proceso de tokenización}
{
  Deben de implementarse mecanismos que garanticen la integridad del proceso
  de generación de \glspl{gl:token}.
}

% GT10
\requerimiento[rq_pci:acceso_a_producto]
{Acceso al proceso de tokenización}
{
  Solo los usuarios autenticados y componentes del sistema tienen permitido
  acceder al proceso de tokenización y de-tokenización. Los métodos utilizados
  deben ser al menos tan rigurosos como lo indicado en el requerimiento 8 del
  \gls{gl:pci} \gls{gl:dss} \cite{pci_dss}.

  % GT10.1
  \subrequerimiento[rq_pci:control_de_peticiones]
  {Control de peticiones}
  {
    Todas las peticiones deben pasar a través de una \gls{gl:api} que controle
    todos los intentos de acceso y aplique de manera uniforma reglas de
    control de acceso.
  }

  % GT10.2
  \subrequerimiento[rq_pci:registros_de_acceso]
  {Registros de acceso}
  {
    Se deben registrar todos los eventos de acceso, de tokenización y
    de detokenización. Esta funcionalidad debe ser configurable de manera
    segura. Para esto se debe seguir el requerimiento 4 del
    \gls{gl:pa}-\gls{gl:dss} \cite{dss_pa}.
  }

  % GT10.3
  \subrequerimiento[rq_pci:autenticacion_multifactor]
  {\gls{gl:autenticacion_multifactor}}
  {
    El sistema debe soportar \gls{gl:autenticacion_multifactor} para todos
    los tipos de usuario: accesos administrativos, operaciones de tokenización
    y detokenización, mantenimiento, etcétera.
  }

  % GT10.4
  \subrequerimiento[rq_pci:acceso_de_sistema]
  {Accesos a nivel de sistema}
  {
    Todos los accesos a nivel de sistema deben soportar
    \gls{gl:autenticacion_mutua}, incluyendo a las peticiones de tokenización
    y detokenización.
  }

  % GT10.5
  \subrequerimiento[rq_pci:acceso_administrativo]
  {Accesos administrativos}
  {
    Se debe utilizar \gls{gl:criptografia_fuerte} para todos los accesos
    administrativos que no se hagan desde consola.
  }
}

% GT11
\requerimiento[rq_pci:token_a_token_prohibido]
{Mapeos de \gls{gl:token} a \gls{gl:token} prohibidos}
{
  No se debe poder pasar de un primer \gls{gl:token} válido a un segundo,
  también válido; forzosamente debe existir un estado intermedio: del primer
  \gls{gl:token} se pasa al \gls{gl:pan} correspondiente (operación de
  detokenización) y de este se pasa al segundo \gls{gl:token}.
}

% GT12
\requerimiento[rq_pci:vulnerabilidades_comunes]
{Protección contra vulnerabilidades comunes}
{
  Se deben implementar medidas en contra de las vulnerabilidades de
  seguridad más comunes (\cite{dss_pa}, requerimiento 5.2). Algunas de estas
  medidas pueden ser el uso de herramientas de análisis de código estático,
  o el uso de lenguajes de programación especializados.
}

% GT13 Primitivas criptográficas usadas.
\requerimiento[rq_pci:primitivas_usadas]
{Primitivas criptográficas usadas}
{
  Las primitivas criptográficas que se usen deben estar basadas en
  estándares nacionales (referentes a Estados Unidos) o internacionales (e. g.
  \gls{gl:aes}). Ver sección \ref{sec:primitivas}.
}

En la tabla \ref{resumen_general} se clasifican los requerimientos presentados
hasta ahora. Las categorías posibles son: \textit{aplicables}, \textit{no
aplicables} y \textit{fuera de alcance}. Los \textit{aplicables} son aquellos
que  se  encuentran dentro del alcance de este trabajo y que, por lo tanto, son
adoptados como requerimientos propios. Los \textit{fuera de alcance} se dejan
fuera por están más allá de las posibilidades de este trabajo.

Los requerimientos, \hipervinculo{rq_pci:productos_de_hardware},
\hipervinculo{rq_pci:productos_de_software},
\hipervinculo{rq_pci:acceso_a_producto} son referentes al cumplimiento
de distintos estándares y recomendaciones (principalmente del \gls{gl:nist});
en la sección \ref{sec:estandares} se resume el contenido de cada uno de
estos.

\begin{table}
  \centering
  \begin{tabular}{| c | c | c |}

    \hline
      \textbf{Requerimiento} &
      \textbf{\gls{gl:pci}} &
      \textbf{Clasificación} \\
    \hline

    \hipervinculo{rq_pci:productos_de_hardware} &
    GT1 &
    Aplicable \\\hline

    \hipervinculo{rq_pci:productos_de_software} &
    GT3 &
    Aplicable \\\hline

    \hipervinculo{rq_pci:resistencia_texto_claro_conocido} &
    GT4 &
    Aplicable \\\hline

    \hipervinculo{rq_pci:resistencia_solo_texto_cifrado} &
    GT5 &
    Aplicable \\\hline

    \hipervinculo{rq_pci:deteccion_anomalias} &
    GT6 &
    Aplicable \\\hline

    \hipervinculo{rq_pci:distincion_token_pan} &
    GT7 &
    Aplicable \\\hline

    \hipervinculo{rq_pci:guia_de_instalacion} &
    GT8 &
    Aplicable \\\hline

    \hipervinculo{rq_pci:integridad_ejecutables} &
    GT9 &
    Aplicable \\\hline

    \hipervinculo{rq_pci:control_de_peticiones} &
    GT10.1 &
    Aplicable \\\hline

    \hipervinculo{rq_pci:registros_de_acceso} &
    GT10.2 &
    Aplicable \\\hline

    \hipervinculo{rq_pci:autenticacion_multifactor} &
    GT10.3 &
    Aplicable \\\hline

    \hipervinculo{rq_pci:acceso_de_sistema} &
    GT10.4 &
    Aplicable \\\hline

    \hipervinculo{rq_pci:acceso_administrativo} &
    GT10.5 &
    Aplicable \\\hline

    \hipervinculo{rq_pci:token_a_token_prohibido} &
    GT11 &
    - \\\hline

    \hipervinculo{rq_pci:vulnerabilidades_comunes} &
    GT12 &
    Aplicable \\\hline

    \hipervinculo{rq_pci:primitivas_usadas} &
    GT13 &
    Aplicable \\\hline

  \end{tabular}
  \caption{Resumen de requerimientos generales.}
  \label{resumen_general}
\end{table}

Los \glspl{gl:token} irreversibles no pueden, bajo ninguna circunstancia, ser
reconvertidos al \gls{gl:pan} original. Esta restricción aplica tanto para
cualquier entidad en el entorno del negocio (comerciante, proveedor de
\glspl{gl:token}, banco) como para cualquier posible atacante. Dados un
\gls{gl:pan} y un \gls{gl:token}, los identificables permiten validar cuando el
primero fue utilizado para la creación del segundo, mientras que los no
identificables, no.

% TODO: ¿Para qué demonios sirven los no identificables?

% TODO: este párrafo me está dando problemas. No quiero copiar tal cuál la
% clasificación del PCI sin manifestar disconformidad, pero tampoco quiero
% entrar en demasiados detalles aún sobre las propias implementaciones
% (las cuales, evidentemente, sí son criptográficas); PD: hay que citar más
% publicaciones, a parte de la de Sandra.

La clasificación del \gls{gl:pci} \gls{gl:ssc} con respecto a los reversibles
resulta un poco confusa (esto ya ha sido señalado antes, \cite{doc_sandra}).
Establece que los criptográficos son generados utilizando
\gls{gl:criptografia_fuerte}, el \gls{gl:pan} nunca se almacena, solamente se
guarda una llave; los no criptográficos guardan la relación entre
\glspl{gl:token} y \gls{gl:pan} en una base de datos. El problema está en que
no se menciona \textit{cómo} generar los no criptográficos. A pesar del nombre,
los métodos más comunes para esta categoría ocupan primitivas criptográficas
(e. g. generadores pseudoaleatorios); además de que, en una implementación
real, para poder cumplir con el \gls{gl:pci} \gls{gl:dss}, la propia base de
datos debe de estar cifrada \cite{pci_dss}.

\gls{gl:pci} \gls{gl:dss} define cuatro \textit{dominios} de seguridad para el
proceso de tokenización:

\begin{enumerate}

  \item \label{dm:gen_tokens} \textbf{Generación de \glspl{gl:token}.}
    Para cada clase tokenizadora, este dominio se encarga de definir
    consideraciones para generación segura de \glspl{gl:token}. Cubre los
    dispositivos, procesos, mecanismos y algoritmos que son utilizados para
    crear los \glspl{gl:token}.

  \item \label{dm:mapeo_tokens} \textbf{Mapeo de \glspl{gl:token}.}
    Este dominio, que se refiere al mapeo de los \glspl{gl:token} con su
    \gls{gl:pan} origen, aplica solamente a los procesos de tokenización
    reversibles. Entre otras cosas, provee guías respecto a control de acceso
    necesarios para las peticiones de tokenización.

  \item \label{dm:card_data} \textbf{Bóveda de datos de tarjeta.}
    Como el dominio pasado, solo aplica a las implementaciones de tokenización
    reversibles. Cubre el cifrado obligado del \gls{gl:pan} y los controles de
    acceso necesarios para entrar a la \gls{gl:cdv}.

  \item \label{dm:man_llaves} \textbf{Manejo criptográfico de llaves.}
    Define las buenas prácticas para el manejo criptográfico de las llaves y
    las operaciones realizadas con ellas por el producto tokenizador.

\end{enumerate}


\input{contenidos/analisis_y_disenio/tokens/requerimientos/irreversibles.tex}
\input{contenidos/analisis_y_disenio/tokens/requerimientos/criptograficos_reversibles.tex}
\input{contenidos/analisis_y_disenio/tokens/requerimientos/no_criptograficos_reversibles.tex}
\input{contenidos/analisis_y_disenio/tokens/requerimientos/primitivas.tex}
