%
% Presentación para congreso.
% Proyecto Lovelace.
%

\documentclass{beamer}
\usepackage{array}
\usepackage{formato}
\newcommand{\Titulo}{\textbf{Un vistazo a la tokenización}}
\newcommand{\Fecha}{Puebla, 14 de octubre de 2018}
\usepackage{formato_presentaciones}

\renewcommand{\Autor}{Daniel Ayala Zamorano \\\vspace{-2mm}
  {\tiny \texttt{daz23ayala@gmail.com}} \\
  Laura Natalia Borbolla Palacios \\\vspace{-2mm}
  {\tiny \texttt{ln.borbolla.42@gmail.com}} \\
  Ricardo Quezada Figueroa \\\vspace{-2mm}
  {\tiny \texttt{qf7.ricardo@gmail.com}} \\
  Sandra Díaz Santiago \\\vspace{-2mm}
  {\tiny \texttt{sdiazs@gmail.com}}}

\setbeameroption{show notes}

\usepackage[caption=false,font=footnotesize]{subfig}
\usepackage{bold-extra}
\usepackage{tikz}
\usetikzlibrary{
  arrows.meta,
  decorations.pathmorphing,
  backgrounds,
  positioning,
  calc,
  scopes,
  shapes}

\tikzset{
  font=\tiny}

\begin{document}

  {\setbeamertemplate{footline}{}
  \frame{\titlepage}}

  \begin{frame}
    \frametitle{Contenido}
    \setcounter{tocdepth}{1}
    \tableofcontents
  \end{frame}

  % Espacio entre párrafos
  \setlength{\parskip}{0.5em}

  \section{El problema de la protección de datos bancarios}

  \begin{frame}{El problema de la protección de datos bancarios}
    \begin{itemize}
      \item El crecimiento del comercio en línea, aunado a sistemas débilmente
        protegidos propició un incremento en los robos de datos bancarios.
    \end{itemize}

    \begin{figure}[H]
      \centering
      \includegraphics[width=0.9\linewidth]
         {diagramas_comunes/intro/perdidas_fraude_bn.png}
      \caption{P\'{e}rdidas debidas al fraude en l\'{i}nea (2001-2012)~\cite{wallethub}.}
    \end{figure}
  \end{frame}

  \begin{frame}{El problema de la protección de datos bancarios}
    \begin{itemize}
      \item En el 2004 se publicó el PCI DSS\footnotemark \cite{pci_dss}.
      \item Hasta este momento el enfoque era proteger la información en donde
        sea que se encuentre.
      \item A pesar de la publicación del estándar, las filtraciones de datos
        no han cesado.
    \end{itemize}
    \footnotetext{\textit{Payment Card Industry, Data Security Standard}}
  \end{frame}

  \section{La tokenización en otros contextos}

  \begin{frame}{La tokenización en otros contextos}
    \begin{itemize}
      \item Moneda de uso particular sin valor legal.
      \item Componente de seguridad en la comunicación por sesiones.
      \item Componente léxico de una gramática.
      \item Una unidad lingüística básica.
      \item Problema social.
    \end{itemize}
  \end{frame}

  \section{¿Qué es la tokenización?}

  \begin{frame}{¿Qué es la tokenización en criptografía?}
    \begin{itemize}
      \item Es la sustitución de datos sensibles por valores representativos
        sin una relación directa.
      \item Existen muchas empresas que proveen el servicio de tokenización,
        pero lo hacen sin detallar la forma en la que se
        realiza~\cite{shif4_uno, braintree_uno, securosis}.
      \item En 2011, el PCI publicó su guía de tokenización~\cite{pci_tokens}.
    \end{itemize}

    \begin{figure}
      \centering
      \begin{tikzpicture}[
        entorno/.style={
          rectangle,
          draw = black,
          thin,
          inner sep = 1mm,
          text width = 15mm,
          align = center,
          minimum height = 1.0cm},
        etiqueta/.style={
          align = center
        }]

        \node[entorno]
          (usuario)
          {Usuario};
        \node[entorno]
          (tienda)
          [right = of usuario]
          {Tienda en línea};
        \node[entorno, fill=gray!30]
          (sistema_tokenizador)
          [right = of tienda]
          {Sistema tokenizador};
        \only<2>{
          \node[entorno]
            (banco)
            [right = of sistema_tokenizador]
            {Entorno bancario};}

        \draw[-Stealth]
          ($(usuario.north) + (0.1in, 0)$)
          --
          ($(usuario.north) + (0.1in, 0.1in)$)
          --
          node[
            etiqueta,
            above]
            {1.
              \only<1>{Tarjeta: \\ \texttt{1234567891234567}}
              \only<2>{Petición de \\ compra}}
          ($(tienda.north) + (-0.1in, 0.1in)$)
          --
          ($(tienda.north) + (-0.1in, 0)$);

        \draw[-Stealth]
          ($(tienda.north) + (0.1in, 0)$)
          --
          ($(tienda.north) + (0.1in, 0.1in)$)
          --
          node[
            etiqueta,
            above]
            {2.
              \only<1>{Tarjeta: \\ \texttt{1234567891234567}}
              \only<2>{Petición de \\ compra}}
          ($(sistema_tokenizador.north) + (-0.1in, 0.1in)$)
          --
          ($(sistema_tokenizador.north) + (-0.1in, 0)$);

        \only<2>{
          \draw[-Stealth]
            ($(sistema_tokenizador.north) + (0.1in, 0)$)
            --
            ($(sistema_tokenizador.north) + (0.1in, 0.1in)$)
            --
            node[
              etiqueta,
              above]
              {3. Petición de \\ transacción}
            ($(banco.north) + (-0.1in, 0.1in)$)
            --
            ($(banco.north) + (-0.1in, 0)$);

          \draw[-Stealth]
            ($(banco.south) + (-0.1in, 0)$)
            --
            ($(banco.south) + (-0.1in, -0.1in)$)
            --
            node[
              etiqueta,
              below]
              {4. Resultado de \\ operación}
            ($(sistema_tokenizador.south) + (0.1in, -0.1in)$)
            --
            ($(sistema_tokenizador.south) + (0.1in, 0)$);}

        \draw[-Stealth]
          ($(sistema_tokenizador.south) + (-0.1in, 0)$)
          --
          ($(sistema_tokenizador.south) + (-0.1in, -0.1in)$)
          --
          node[
            etiqueta,
            below]
            {\only<1>{3. Token: \\ \texttt{2954634586102951}}
             \only<2>{5. Resultado de \\ operación}}
          ($(tienda.south) + (0.1in, -0.1in)$)
          --
          ($(tienda.south) + (0.1in, 0)$);

        \draw[-Stealth]
          ($(tienda.south) + (-0.1in, 0)$)
          --
          ($(tienda.south) + (-0.1in, -0.1in)$)
          --
          node[
            etiqueta,
            below]
            {\only<1>{4}\only<2>{6}. Resultado de \\ operación}
          ($(usuario.south) + (0.1in, -0.1in)$)
          --
          ($(usuario.south) + (0.1in, 0)$);

      \end{tikzpicture}
      \caption{Arquitectura de sistema tokenizador:
        \only<1>{operación de tokenización}%
        \only<2>{transacción bancaria}.}
    \end{figure}
  \end{frame}

  \section{Clasificación del PCI}

  \begin{frame}{Clasificación de los algoritmos tokenizadores}
    {Clasificación del PCI \cite{pci_tokens}}
    \begin{itemize}
      \item \textbf{Reversibles:} se puede regresar, a partir del token, al
        número de tarjeta original.
        \begin{itemize}
          \item \textbf{Criptográficos:} cifran el token y descifran la
            tarjeta.
          \item \textbf{No criptográficos:} ocupan una base de datos para
            guardar la relación entre números de tarjetas y tokens.
        \end{itemize}
      \item \textbf{Irreversibles:} no se puede regresar al número de tarjeta a
        partir del token.
        \begin{itemize}
          \item \textbf{Autenticables:} permiten validar cuando un token
            corresponde a un número de tarjeta dado.
          \item \textbf{No autenticables:} no permiten hacer la validación
            anterior.
        \end{itemize}
    \end{itemize}
  \end{frame}

  \begin{frame}{Clasificación de los algoritmos tokenizadores}
    {Clasificación propuesta}
    \begin{itemize}
      \item \textbf{Criptográficos:} ocupan primitivas criptográficas en su
        operación.
      \begin{itemize}
        \item \textbf{Reversibles:} cifran el token y descifran la
          tarjeta.
        \item \textbf{Irreversibles:} ocupan una base de datos para
          guardar la relación entre números de tarjetas y tokens.
      \end{itemize}
      \item \textbf{No criptográficos:} no ocupan nada relacionado con la
          criptografía.
      \begin{itemize}
        \item[]
        \item[]
      \end{itemize}
    \end{itemize}
  \end{frame}

  \section{Métodos reversibles: FFX y BPS}

  \begin{frame}{Métodos reversibles: FFX y BPS}

    \begin{itemize}
      \item Métodos que utilizan cifrados que preservan el formato.
      \item Cifran la tarjeta y descifran el token.
      \item Se volvieron estándares en 2016 y fueron renombrados por el NIST
        a FF1 y FF3 respectivamente.
      \item Están basados en redes Feistel.
    \end{itemize}

    \begin{figure}
      \centering
      \begin{tikzpicture}[
        entorno/.style={
          rectangle,
          draw = black,
          thin,
          inner sep = 1mm,
          text width = 15mm,
          align = center,
          minimum height = 1.0cm},
        etiqueta/.style={
          align = center
        }]

        \node[entorno]
          (fpe)
          {$ FPE $};

        \draw[-Stealth]
          ($(fpe.west) + (0, 3mm) + (-0.5in, 0)$)
          node[etiqueta, anchor = east]
            {Este es un \\ mensaje secreto}
          --
          node[etiqueta, above]
            {Mensaje}
          ($(fpe.west) + (0, 3mm)$);

        \draw[-Stealth]
          ($(fpe.west) - (0, 3mm) + (-0.5in, 0)$)
          node[etiqueta, anchor = east]
            {$\{0,1\}^n$}
          --
          node[etiqueta, below]
            {Llave}
          ($(fpe.west) - (0, 3mm)$);

        \draw[-Stealth]
          (fpe.east)
          --
          node[etiqueta, above]
            {Cifrado}
          ($(fpe.east) + (0.5in, 0)$)
          node[etiqueta, anchor = west]
            {abf hyfhg \\ jfhn nh nmkr};

        \node[entorno]
          (fpe_inverso)
          [below = 0.25in of fpe]
          {$ {FPE}^{-1} $};

        \draw[-Stealth]
          ($(fpe_inverso.west) + (0, 3mm) + (-0.5in, 0)$)
          node[etiqueta, anchor = east]
            {abf hyfhg \\ jfhn nh nmkr}
          --
          node[etiqueta, above]
            {Mensaje}
          ($(fpe_inverso.west) + (0, 3mm)$);

        \draw[-Stealth]
          ($(fpe_inverso.west) - (0, 3mm) + (-0.5in, 0)$)
          node[etiqueta, anchor = east]
            {$\{0,1\}^n$}
          --
          node[etiqueta, below]
            {Llave}
          ($(fpe_inverso.west) - (0, 3mm)$);

        \draw[-Stealth]
          (fpe_inverso.east)
          --
          node[etiqueta, above]
            {Mensaje}
          ($(fpe_inverso.east) + (0.5in, 0)$)
          node[etiqueta, anchor = west]
            {Este es un \\ mensaje secreto};

      \end{tikzpicture}
    \end{figure}
  \end{frame}

  \begin{frame}{Comparativa: FFX y BPS}

    \begin{table}
      \begin{tabular}{|m{0.35\textwidth}|m{0.26\textwidth}|m{0.25\textwidth}|}
        \hline
        \textbf{Características} & \textbf{FFX} & \textbf{BPS}
        \\\hline
        Longitud de cadena & [4,36] caracteres & hasta $56 \cdot 2^{128}$ caracteres
        \\\hline
        Primitiva criptográfica & AES CBC-MAC & AES
        \\\hline
        Tamaño de llave & 128 bits & 128 bits
        \\\hline
        Tamaño de \textit{tweak} & menor a $2^{64}$ bits & 64 bits
        \\\hline
        Número de rondas & 12, 28 o 24 & 8 recomendadas
        \\\hline
      \end{tabular}
      \caption{Comparativa de FFX y BPS.}
    \end{table}

  \end{frame}

  \section{Métodos irreversibles: TKR, AHR y DRBG}

  \begin{frame}{Métodos irreversibles: TKR, AHR y DRBG}
    \begin{itemize}
      \item Utilizan varias primitivas criptográficas (cifrados por bloque,
        funciones hash, generadores pseudoaleatorios).
      \item Requieren guardar la relación tarjeta-token.
      \item Su desempeño está ligado a la base de datos.
    \end{itemize}

    \begin{figure}
      \centering
      \begin{tikzpicture}[
        entorno/.style={
          rectangle,
          draw = black,
          thin,
          inner sep = 1mm,
          text width = 15mm,
          align = center,
          minimum height = 1.0cm},
        etiqueta/.style={
          align = center
        }]

        \node[entorno]
          (irreversible)
          {Irreversible};

        \node[entorno]
          (base)
          [right = 0.5in of irreversible]
          {Base de datos};

        \draw[-Stealth]
          ($(irreversible.west) + (-0.5in, 0)$)
          node[etiqueta, anchor = east]
            {Número de \\ tarjeta}
          --
          (irreversible.west);

        \draw[-Stealth]
          (irreversible.east)
          --
          (base.west);

        \draw[-Stealth]
          (base.east)
          --
          ($(base.east) + (0.5in, 0)$)
          node[etiqueta, anchor = west]
            {Token};

        \node[entorno]
          (base_dos)
          at ($(irreversible.south)!0.5!(base.south) + (0, -0.5in)$)
          {Base de datos};

        \draw[-Stealth]
          ($(base_dos.west) + (-0.5in, 0)$)
          node[etiqueta, anchor = east]
            {Token}
          --
          (base_dos.west);

        \draw[-Stealth]
          (base_dos.east)
          --
          ($(base_dos.east) + (0.5in, 0)$)
          node[etiqueta, anchor = west]
            {Número de \\ tarjeta};

      \end{tikzpicture}
    \end{figure}
  \end{frame}

  \begin{frame}{Métodos irreversibles: TKR, AHR y DRBG}
    \begin{table}
      \begin{tabular}{|m{3cm}|m{2.0cm}|m{2.0cm}|m{2.0cm}|}
        \hline
        \textbf{Características}
          & \textbf{TKR}
          & \textbf{AHR}
          & \strut \textbf{DRBG} \\ \hline
        \parbox{3cm}{%
          \raggedright{Primitivas criptográficas}} &
        \parbox{2.0cm}{%
          \raggedright{Cifrado por bloque.}} &
        \parbox{2.0cm}{%
          \strut\raggedright{Cifrado por bloque y función hash.}\strut} &
        \parbox{2.0cm}{%
          \strut\raggedright{Función hash o cifrado por bloque.}\strut} \\\hline
        \parbox{3cm}{%
          \strut\raggedright{Tamaño de llave}\strut} &
        \parbox{2.0cm}{%
          \raggedright{16 bytes}} &
        \parbox{2.0cm}{%
          \raggedright{32 bytes}} &
        \parbox{2.0cm}{%
          \raggedright{-}} \\\hline
        \parbox{3cm}{%
          \strut\raggedright{Función para mantenerse en el dominio}\strut} &
        \parbox{2.0cm}{%
          \raggedright{Función RN}} &
        \parbox{2.0cm}{%
          \raggedright{Caminata cíclica}} &
        \parbox{2.0cm}{%
          \raggedright{-}}\\\hline
      \end{tabular}
      \caption{Características de los algoritmos tokenizadores irreversibles.}
      \label{tabla:algoritmos_irreversibles}
    \end{table}
  \end{frame}

  \section{Resultados y conclusiones}
  \begin{frame}{Resultados}
    \begin{figure}[H]
      \centering
      \includegraphics[width=0.9\linewidth]
        {articulo-rci/tiempos_unitarios.png}
        \caption{Tokenización y detokenización.}
    \end{figure}
  \end{frame}

  \begin{frame}{Resultados}
    \begin{figure}[H]
      \centering
      \includegraphics[width=0.9\linewidth]
        {articulo-rci/tiempos_tokenizacion.png}
        \caption{Generación de tokens.}
    \end{figure}
  \end{frame}

  \begin{frame}{Conclusiones}
    \begin{itemize}
      \item La tokenización es una aplicación de la criptografía.
      \item La denominación \textit{no criptográfica} del PCI es contradictoria.
      \item Los algoritmos reversibles son más últiles cuando se necesita tanto tokenizar como detokenizar con frecuencia.
      \item Los algoritmos irreversibles son más últiles cuando se requiere detokenizar con frecuencia.
    \end{itemize}
  \end{frame}

  \begin{frame}[allowframebreaks]{Bibliografía}
    \printbibliography
  \end{frame}

  \begin{frame}{}
    \centering \Huge
    \textsc{Gracias por su atención.}
  \end{frame}

  % Espacio entre párrafos
  \setlength{\parskip}{0.0em}

  {\setbeamertemplate{footline}{}
  \frame{\titlepage}}

\end{document}
