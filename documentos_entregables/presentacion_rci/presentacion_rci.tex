%
% Presentación para congreso.
% Proyecto Lovelace.
%

\documentclass{beamer}
\usepackage{array}
\usepackage{formato}
\newcommand{\Titulo}{\textbf{Un vistazo a la tokenización}}
\newcommand{\Fecha}{Puebla, 14 de octubre de 2018}
\usepackage{formato_presentaciones}

\renewcommand{\Autor}{Daniel Ayala Zamorano \\\vspace{-2mm}
  {\tiny \texttt{daz23ayala@gmail.com}} \\
  Laura Natalia Borbolla Palacios \\\vspace{-2mm}
  {\tiny \texttt{ln.borbolla.42@gmail.com}} \\
  Ricardo Quezada Figueroa \\\vspace{-2mm}
  {\tiny \texttt{qf7.ricardo@gmail.com}} \\
  Sandra Díaz Santiago \\\vspace{-2mm}
  {\tiny \texttt{sdiazs@gmail.com}}}

\setbeameroption{show notes}

\usepackage[caption=false,font=footnotesize]{subfig}
\usepackage{bold-extra}
\usepackage{tikz}
\usetikzlibrary{
  arrows.meta,
  decorations.pathmorphing,
  backgrounds,
  positioning,
  calc,
  scopes,
  shapes}

\tikzset{
  font=\tiny}

\begin{document}

  {\setbeamertemplate{footline}{}
  \frame{\titlepage}}

  \begin{frame}
    \frametitle{Contenido}
    \setcounter{tocdepth}{1}
    \tableofcontents
  \end{frame}

  % Espacio entre párrafos
  \setlength{\parskip}{0.5em}

  \section{El problema de la protección de datos bancarios}

  \begin{frame}{El problema de la protección de datos bancarios}
    \begin{itemize}
      \item El crecimiento del comercio en línea, aunado a sistemas débilmente
        protegidos, propició un incremento en los robos de datos bancarios.
    \end{itemize}

    \begin{figure}[H]
      \centering
      \includegraphics[width=0.9\linewidth]
         {diagramas_comunes/intro/perdidas_fraude_bn.png}
      \caption{Pérdidas debidas al fraude en línea (2001-2012)~\cite{wallethub}.}
    \end{figure}
  \end{frame}

  \begin{frame}{El problema de la protección de datos bancarios}
    \begin{itemize}
      \item En el 2004 se publicó el PCI DSS\footnotemark \cite{pci_dss}.
      \item Hasta este momento el enfoque era proteger la información en donde
        sea que se encuentre.
      \item A pesar de la publicación del estándar, las filtraciones de datos
        no han cesado.
    \end{itemize}
    \footnotetext{\textit{Payment Card Industry, Data Security Standard}}
  \end{frame}

  \section{La tokenización en otros contextos}

  \begin{frame}{La tokenización en otros contextos}
    \begin{itemize}
      \item Moneda de uso particular sin valor legal.
      \item Componente de seguridad en la comunicación por sesiones.
      \item Componente léxico de una gramática.
      \item Una unidad lingüística básica.
      \item Fenómeno social.
    \end{itemize}
  \end{frame}

  \section{¿Qué es la tokenización?}

  \begin{frame}{¿Qué es la tokenización?}
    \begin{itemize}
      \item Es la sustitución de datos sensibles por valores representativos
        sin una relación directa.
      \item Existen muchas empresas que proveen el servicio de tokenización,
        pero lo hacen sin detallar la forma en la que se
        realiza~\cite{shif4_uno, braintree_uno, securosis}.
      \item En 2011, el PCI publicó su guía de tokenización~\cite{pci_tokens}.
    \end{itemize}

    \begin{figure}
      \centering
      \begin{tikzpicture}[
        entorno/.style={
          rectangle,
          draw = black,
          thin,
          inner sep = 1mm,
          text width = 15mm,
          align = center,
          minimum height = 1.0cm},
        etiqueta/.style={
          align = center
        }]

        \node[entorno]
          (usuario)
          {Usuario};
        \node[entorno]
          (tienda)
          [right = of usuario]
          {Tienda en línea};
        \node[entorno, fill=gray!30]
          (sistema_tokenizador)
          [right = of tienda]
          {Sistema tokenizador};
        \only<2>{
          \node[entorno]
            (banco)
            [right = of sistema_tokenizador]
            {Entorno bancario};}

        \draw[-Stealth]
          ($(usuario.north) + (0.1in, 0)$)
          --
          ($(usuario.north) + (0.1in, 0.1in)$)
          --
          node[
            etiqueta,
            above]
            {1.
              \only<1>{Tarjeta: \\ \texttt{1234567891234567}}
              \only<2>{Petición de \\ compra}}
          ($(tienda.north) + (-0.1in, 0.1in)$)
          --
          ($(tienda.north) + (-0.1in, 0)$);

        \draw[-Stealth]
          ($(tienda.north) + (0.1in, 0)$)
          --
          ($(tienda.north) + (0.1in, 0.1in)$)
          --
          node[
            etiqueta,
            above]
            {2.
              \only<1>{Tarjeta: \\ \texttt{1234567891234567}}
              \only<2>{Petición de \\ compra}}
          ($(sistema_tokenizador.north) + (-0.1in, 0.1in)$)
          --
          ($(sistema_tokenizador.north) + (-0.1in, 0)$);

        \only<2>{
          \draw[-Stealth]
            ($(sistema_tokenizador.north) + (0.1in, 0)$)
            --
            ($(sistema_tokenizador.north) + (0.1in, 0.1in)$)
            --
            node[
              etiqueta,
              above]
              {3. Petición de \\ transacción}
            ($(banco.north) + (-0.1in, 0.1in)$)
            --
            ($(banco.north) + (-0.1in, 0)$);

          \draw[-Stealth]
            ($(banco.south) + (-0.1in, 0)$)
            --
            ($(banco.south) + (-0.1in, -0.1in)$)
            --
            node[
              etiqueta,
              below]
              {4. Resultado de \\ operación}
            ($(sistema_tokenizador.south) + (0.1in, -0.1in)$)
            --
            ($(sistema_tokenizador.south) + (0.1in, 0)$);}

        \draw[-Stealth]
          ($(sistema_tokenizador.south) + (-0.1in, 0)$)
          --
          ($(sistema_tokenizador.south) + (-0.1in, -0.1in)$)
          --
          node[
            etiqueta,
            below]
            {\only<1>{3. Token: \\ \texttt{2954634586102951}}
             \only<2>{5. Resultado de \\ operación}}
          ($(tienda.south) + (0.1in, -0.1in)$)
          --
          ($(tienda.south) + (0.1in, 0)$);

        \draw[-Stealth]
          ($(tienda.south) + (-0.1in, 0)$)
          --
          ($(tienda.south) + (-0.1in, -0.1in)$)
          --
          node[
            etiqueta,
            below]
            {\only<1>{4}\only<2>{6}. Resultado de \\ operación}
          ($(usuario.south) + (0.1in, -0.1in)$)
          --
          ($(usuario.south) + (0.1in, 0)$);

      \end{tikzpicture}
      \caption{Arquitectura de sistema tokenizador:
        \only<1>{operación de tokenización}%
        \only<2>{transacción bancaria}.}
    \end{figure}
  \end{frame}

  \section{Clasificación del PCI}

  \begin{frame}{Clasificación de los algoritmos tokenizadores}
    {Clasificación del PCI \cite{pci_tokens}}
    \begin{itemize}
      \item \textbf{Reversibles:} se puede regresar, a partir del token, al
        número de tarjeta original.
        \begin{itemize}
          \item \textbf{Criptográficos:} cifran la tarjeta y descifran el
            token.
          \item \textbf{No criptográficos:} utilizan una base de datos para
            guardar la relación entre números de tarjeta y tokens.
        \end{itemize}
      \item \textbf{Irreversibles:} no se puede regresar al número de tarjeta a
        partir del token.
        \begin{itemize}
          \item \textbf{Autenticables:} permiten validar cuando un token
            corresponde a un número de tarjeta dado.
          \item \textbf{No autenticables:} no se puede hacer la validación
            anterior.
        \end{itemize}
    \end{itemize}
  \end{frame}

  \begin{frame}{Clasificación de los algoritmos tokenizadores}
    {Clasificación propuesta}
    \begin{itemize}
      \item \textbf{Criptográficos:} ocupan primitivas criptográficas en su
        operación.
      \begin{itemize}
        \item \textbf{Reversibles:} cifran la tarjeta y descifran el
          token.
        \item \textbf{Irreversibles:} requieren una base de datos para
          guardar la relación entre números de tarjetas y tokens.
      \end{itemize}
      \item \textbf{No criptográficos:} no utilizan nada relacionado con la
          criptografía.
    \end{itemize}
  \end{frame}

  \section{Métodos reversibles: FFX y BPS}

  \begin{frame}{Métodos reversibles: FFX y BPS}

    \begin{itemize}
      \item Métodos que utilizan cifrados que preservan el formato.
      \item Cifran la tarjeta y descifran el token.
      \item Se volvieron estándares en 2016 y fueron renombrados por el NIST
        a FF1 y FF3 respectivamente~\cite{nist_fpe}.
      \item Están basados en redes Feistel.
    \end{itemize}

    \begin{figure}
      \centering
      \subfloat[Proceso de tokenización]{
        \begin{tikzpicture}[
          entorno/.style={
            rectangle,
            draw = black,
            thin,
            inner sep = 1mm,
            text width = 15mm,
            align = center,
            minimum height = 1.0cm},
          etiqueta/.style={
            align = center
          }]

          \node[entorno]
            (fpe)
            {$ FPE $};

          \draw[-Stealth]
            ($(fpe.west) + (0, 3mm) + (-0.5in, 0)$)
            node[etiqueta, anchor = east]
              {\texttt{5221 3001 9867 8764}}
            --
            node[etiqueta, above]
              {Mensaje}
            ($(fpe.west) + (0, 3mm)$);

          \draw[-Stealth]
            ($(fpe.west) - (0, 3mm) + (-0.5in, 0)$)
            --
            node[etiqueta, below]
              {Llave}
            ($(fpe.west) - (0, 3mm)$);

          \draw[-Stealth]
            (fpe.east)
            --
            node[etiqueta, above]
              {Cifrado}
            ($(fpe.east) + (0.5in, 0)$)
            node[etiqueta, anchor = west]
              {\texttt{1758 9855 9830 7620}};
        \end{tikzpicture}
      }
      \\
      \vspace{0.1in}
      \subfloat[Proceso de detokenización]{
        \begin{tikzpicture}[
          entorno/.style={
            rectangle,
            draw = black,
            thin,
            inner sep = 1mm,
            text width = 15mm,
            align = center,
            minimum height = 1.0cm},
          etiqueta/.style={
            align = center
          }]
          \node[entorno]
            (fpe_inverso)
            {$ {FPE}^{-1} $};

          \draw[-Stealth]
            ($(fpe_inverso.west) + (0, 3mm) + (-0.5in, 0)$)
            node[etiqueta, anchor = east]
              {\texttt{1758 9855 9830 7620}}
            --
            node[etiqueta, above]
              {Cifrado}
            ($(fpe_inverso.west) + (0, 3mm)$);

          \draw[-Stealth]
            ($(fpe_inverso.west) - (0, 3mm) + (-0.5in, 0)$)
            --
            node[etiqueta, below]
              {Llave}
            ($(fpe_inverso.west) - (0, 3mm)$);

          \draw[-Stealth]
            (fpe_inverso.east)
            --
            node[etiqueta, above]
              {Mensaje}
            ($(fpe_inverso.east) + (0.5in, 0)$)
            node[etiqueta, anchor = west]
              {\texttt{5221 3001 9867 8764}};
        \end{tikzpicture}}
    \end{figure}
  \end{frame}

  \begin{frame}{Comparativa: FFX y BPS}

    \begin{table}
      \begin{tabular}{|m{0.35\textwidth}|m{0.26\textwidth}|m{0.25\textwidth}|}
        \hline
        \parbox{0.35\textwidth}{\textbf{Características}} &
        \parbox{0.26\textwidth}{\textbf{FFX}} &
        \parbox{0.25\textwidth}{\textbf{BPS}}
        \\\hline
        \parbox{0.35\textwidth}{%
          \strut Longitud de cadena \\
          {\scriptsize(en caracteres)} \strut} &
        \parbox{0.26\textwidth}{$4 \ - \ 36$} &
        \parbox{0.25\textwidth}{$0 \ - \ 1.9x10^{40}$}
        \\\hline
        \parbox{0.35\textwidth}{\strut Primitivas \\ criptográficas\strut} &
        \parbox{0.26\textwidth}{AES CBC-MAC} &
        \parbox{0.25\textwidth}{AES}
        \\\hline
        \parbox{0.35\textwidth}{Tamaño de llave} &
        \parbox{0.26\textwidth}{128 bits} &
        \parbox{0.25\textwidth}{128 bits}
        \\\hline
        \parbox{0.35\textwidth}{Tamaño de \textit{tweak}} &
        \parbox{0.26\textwidth}{menor a $2^{64}$ bits} &
        \parbox{0.25\textwidth}{64 bits}
        \\\hline
        \parbox{0.35\textwidth}{Número de rondas} &
        \parbox{0.26\textwidth}{12, 24 o 28} &
        \parbox{0.25\textwidth}{\strut mínimo 8 recomendadas \strut}
        \\\hline
      \end{tabular}
      \caption{Características de los algoritmos tokenizadores
        reveribles~\cite{ffx_1, bps}.}
    \end{table}

  \end{frame}

  \section{Métodos irreversibles: TKR, AHR y DRBG}

  \begin{frame}{Métodos irreversibles: TKR, AHR y DRBG}
    \begin{itemize}
      \item Utilizan varias primitivas criptográficas (cifrados por bloque,
        funciones hash, generadores pseudoaleatorios).
      \item Requieren guardar la relación tarjeta-token.
      \item Su desempeño está ligado a la base de datos.
    \end{itemize}

    \begin{figure}
      \centering
      \subfloat[Proceso de tokenización]{
        \begin{tikzpicture}[
          entorno/.style={
            rectangle,
            draw = black,
            thin,
            inner sep = 1mm,
            text width = 15mm,
            align = center,
            minimum height = 1.0cm},
          etiqueta/.style={
            align = center
          }]

          \node[entorno]
            (irreversible)
            {Algoritmo \\ tokenizador};

          \node[entorno]
            (base)
            [right = 0.5in of irreversible]
            {Base de datos};

          \draw[-Stealth]
            ($(irreversible.west) + (-0.5in, 0) + (0, 3mm)$)
            node[etiqueta, anchor = east]
              {Número de \\ tarjeta}
            --
            ($(irreversible.west) + (0, 3mm)$);

          \draw[-Stealth]
            ($(irreversible.west) + (-0.5in, 0) - (0, 3mm)$)
            node[etiqueta, anchor = east]
              {Llave}
            --
            ($(irreversible.west) - (0, 3mm)$);

          \draw[-Stealth]
            (irreversible.east)
            --
            (base.west);

          \draw[-Stealth]
            (base.east)
            --
            ($(base.east) + (0.5in, 0)$)
            node[etiqueta, anchor = west]
              {Token};

        \end{tikzpicture}
      }
      \\
      \vspace{0.1in}
      \subfloat[Proceso de detokenización]{
        \begin{tikzpicture}[
          entorno/.style={
            rectangle,
            draw = black,
            thin,
            inner sep = 1mm,
            text width = 15mm,
            align = center,
            minimum height = 1.0cm},
          etiqueta/.style={
            align = center
          }]

          \node[entorno]
            (base_dos)
            {Base de datos};

          \draw[-Stealth]
            ($(base_dos.west) + (-0.5in, 0)$)
            node[etiqueta, anchor = east]
              {Token}
            --
            (base_dos.west);

          \draw[-Stealth]
            (base_dos.east)
            --
            ($(base_dos.east) + (0.5in, 0)$)
            node[etiqueta, anchor = west]
              {Número de \\ tarjeta};

        \end{tikzpicture}}
    \end{figure}
  \end{frame}

  \begin{frame}{Métodos irreversibles: TKR, AHR y DRBG}
    \begin{table}
      \begin{tabular}{|m{3cm}|m{2.0cm}|m{2.0cm}|m{2.0cm}|}
        \hline
        \parbox{3.0cm}{\textbf{Características}}
        & \parbox{2.0cm}{\textbf{TKR}}
        & \parbox{2.0cm}{\textbf{AHR}}
        & \parbox{2.0cm}{\textbf{DRBG}} \\\hline
        \parbox{3cm}{%
          \raggedright{Primitivas criptográficas}} &
        \parbox{2.0cm}{%
          \raggedright{Cifrado por bloque.}} &
        \parbox{2.0cm}{%
          \strut\raggedright{Cifrado por bloque y función hash.}\strut} &
        \parbox{2.0cm}{%
          \strut\raggedright{Función hash o cifrado por bloque.}\strut} \\\hline
        \parbox{3cm}{%
          \strut\raggedright{Tamaño de llave}\strut} &
        \parbox{2.0cm}{%
          \raggedright{16 bytes}} &
        \parbox{2.0cm}{%
          \raggedright{32 bytes}} &
        \parbox{2.0cm}{%
          \raggedright{-}} \\\hline
        \parbox{3cm}{%
          \strut\raggedright{¿Utiliza \textit{tweak}?}\strut} &
        \parbox{2.0cm}{%
          \raggedright{Sí}} &
        \parbox{2.0cm}{%
          \raggedright{Sí}} &
        \parbox{2.0cm}{%
          \raggedright{No}}\\\hline
      \end{tabular}
      \caption{Características de los algoritmos tokenizadores
        irreversibles~\cite{doc_sandra, aragona, nist_aleatorios}.}
      \label{tabla:algoritmos_irreversibles}
    \end{table}
  \end{frame}

  \section{Resultados y conclusiones}
  \begin{frame}{Resultados}
    Las pruebas de desempeño de llevaron a cabo en una computadora con las
    siguientes características:
    \begin{itemize}
      \item \textbf{Procesador:} Intel i5-7200U (2.5 GHz) de 4 núcleos.
      \item \textbf{Sistema operativo:} Arch Linux, kernel 4.18.
      \item \textbf{Base de datos:} MariaDB 10.1.
      \item \textbf{Compilador:} GCC 8.1.1.
    \end{itemize}
    El procesador utiliza los conjuntos de instrucciones de Intel
    AES-NI y RD-SEED~\cite{aesni_wp}.
  \end{frame}

  \begin{frame}{Resultados}
    \begin{figure}[H]
      \centering
      \includegraphics[width=0.9\linewidth]
        {articulo-rci/tiempos_unitarios.png}
        \caption{Tokenización y detokenización.}
    \end{figure}
  \end{frame}

  \begin{frame}{Resultados}
    \begin{figure}[H]
      \centering
      \includegraphics[width=0.9\linewidth]
        {articulo-rci/tiempos_tokenizacion.png}
        \caption{Generación de tokens.}
    \end{figure}
  \end{frame}

  \begin{frame}{Conclusiones}
    \begin{itemize}
      \item La tokenización es una aplicación de la criptografía.
      \item La denominación \textit{no criptográfica} del PCI es contradictoria.
      \item Los algoritmos reversibles son más últiles cuando se necesita tanto
        tokenizar como detokenizar con frecuencia.
      \item Los algoritmos irreversibles son más últiles cuando se requiere
        detokenizar con frecuencia.
    \end{itemize}
  \end{frame}

  \begin{frame}[allowframebreaks]{Bibliografía}
    \printbibliography
  \end{frame}

  \begin{frame}{}
    \centering \Huge
    \textsc{Gracias por su atención.}
  \end{frame}

  % Espacio entre párrafos
  \setlength{\parskip}{0.0em}

  {\setbeamertemplate{footline}{}
  \frame{\titlepage}}

\end{document}
