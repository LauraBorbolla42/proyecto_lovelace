%
% Plantilla para definición de requerimientos.
% Proyecto Lovelace.
%

% Contadores de requerimientos
\newcounter{contador_requerimientos}[chapter]
\newcounter{contador_subrequerimientos}[chapter]

% Comando para requerimientos.
% #1 -> Etiqueta (opcional).
% #2 -> Prefijo para numeración.
% #3 -> Título del requerimiento.
% #4 -> Descripción.
% TODO:
%   - Guardar en variable temporal separación inicial entre párrafos.
%   - Los tamaños de indentación deben tomar como base la identación de
%     todo el documento.
%
% Para comandos con más de un parámetro:
% https://texfaq.org/FAQ-twooptarg
% La idea general consiste en definir un comando externo que tome
% un primer argumento opcional y redirigirlo a un segundo comando interno
% que tome un segundo comando por defecto.
% Lo anterior es porque «newcommand» solo soporta un argumento
% opcional... Parece que LaTeX está lleno de este tipo de parches, en lugar
% de reimplementaciones sobre el código central.
% Los paquetes «twoopt» o «xarg» automatizan esta técnica.

\newcommand{\requerimiento}[4]
[rq:\formatearnumero{contador_requerimientos}]
{
  % Configuración
  \refstepcounter{contador_requerimientos}
  \setcounter{contador_subrequerimientos}{0}
  \setlength{\parskip}{0em}

  % Código efectivo
  \vspace{1.0em}
  \noindent
  \textbf{\hypertarget{#1}
    {REQ#2-\formatearnumero{contador_requerimientos} #3}.}
  \par
  \begin{hangparas}{2em}{0}
    #4
  \end{hangparas}

  % Regresar a estado previo
  \setlength{\parskip}{1.0em}
}

% Comando para subrequerimientos.
% #1 -> Etiqueta (opcional).
% #2 -> Prefijo para numeración.
% #3 -> Título del subrequerimiento.
% #4 -> Descripción.
% ATENCIÓN:  Los subrequerimientos siempre deben estar dentro de la
% descripción de un requerimiento.

\newcommand{\subrequerimiento}[4]
[rq:\formatearnumero{contador_requerimientos}_%
  \arabic{contador_subrequerimientos}]
{
  % Configuración
  \refstepcounter{contador_subrequerimientos}

  % Código efectivo
  \vspace{1.0em}
  \textbf{\hypertarget{#1}
    {SUBREQ#2-\formatearnumero{contador_requerimientos}%
      /\arabic{contador_subrequerimientos} #3}.}
  \par
  \begin{hangparas}{4em}{0}
    #4
  \end{hangparas}
}

