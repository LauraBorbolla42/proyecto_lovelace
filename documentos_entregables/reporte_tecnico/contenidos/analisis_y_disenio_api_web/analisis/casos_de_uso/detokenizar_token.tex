%
% Caso de uso para detokenizar un token.
% Capítulo de análisis y diseño de api web,
% Proyecto Lovelace.
%

\casoDeUso[cu:detokenizar_token]
{Detokenizar un token}
{
  Permite a un usuario tipo \textbf{cliente}, dada una conexión establecida, obtener el
  número de una tarjeta a partir de un token.

  \begin{trayectoriaPrincipal}

    \item El cliente envía una petición con los siguientes datos:
      \begin{itemize}
        \item Token.
        \item Algoritmo tokenizador.
      \end{itemize}

    \item El sistema obtiene el estado del cliente.

    \item El sistema verifica que el estado del cliente sea \textbf{aceptado}
      o \textbf{en cambio de llaves}, (tomando en cuenta la regla de negocios
      \hipervinculo{rn:estado_de_usuario});
      [\hipervinculoLocal{ta:cliente_sin_permisos}].

    \item El sistema verifica que el tipo de algoritmo utilizado sea
      \textbf{irreversible} (tomando en cuenta la regla de negocios
      \hipervinculo{rn:tipo_de_algoritmo});
      [\hipervinculoLocal{ta:cliente_aceptado_reversible},
      \hipervinculoLocal{ta:cliente_en_cambio_reversible}].

    \item El sistema obtiene el número de tarjeta relacionado con este token
      realizando una consulta a la base de datos
      [\hipervinculoLocal{ta:token_inexistente}].

    \item [regreso_tarjeta] El sistema regresa al cliente el número de tarjeta
      obtenido en el paso anterior.

  \end{trayectoriaPrincipal}

  \begin{trayectoriaAlternativa}[ta:cliente_sin_permisos]
    {El cliente tiene un estado distinto a \textbf{aceptado} o
      \textbf{en cambio de llaves}.}

    \item El sistema regresa un valor nulo al cliente.
      % ¿Hay que regresar un error aquí o qué onda?

  \end{trayectoriaAlternativa}

  \begin{trayectoriaAlternativa}[ta:cliente_aceptado_reversible]
    {El cliente se encuentra en estado \textbf{aceptado} y el algoritmo
    especificado es de tipo \textbf{reversible}.}

    \item El sistema obtiene el númer de tarjeta con el token y la llave
      con estado \textbf{actual}, tomando en cuenta la regla de negocios
      \hipervinculo{rn:detokenizacion}
      [\hipervinculoLocal{ta:error_detokenizacion}].

    \item Regresar al paso \referenciaLocal{regreso_tarjeta} de la trayectoria
      principal.

  \end{trayectoriaAlternativa}

  \begin{trayectoriaAlternativa}[ta:cliente_en_cambio_reversible]
    {El cliente se encuentra en estado \textbf{en cambio de llaves} y el
    algoritmo especificado es de tipo \textbf{reversible}.}

    \item El sistema obtiene de la petición la llave con la que se realizará
      la operación de detokenización, tomando en cuenta la regla de negocios
      \hipervinculo{rn:detokenizacion_en_refresco}.

    \item El sistema obtiene el número de tarjeta con el token y la llave
      especificada en el paso anterior
      [\hipervinculoLocal{ta:error_detokenizacion}].

    \item Regresar al paso \referenciaLocal{regreso_tarjeta} de la trayectoria
      principal.

  \end{trayectoriaAlternativa}

  \begin{trayectoriaAlternativa}[ta:token_inexistente]
    {EL token especificado no se encuentra registrado en la base de datos.}

    \item El sistema regresa un valor nulo al cliente.

  \end{trayectoriaAlternativa}

  \begin{trayectoriaAlternativa}[ta:error_detokenizacion]
    {Ocurrió un error durante el proceso de detokenización.}

    \item El sistema regresa un valor nulo al cliente.
      % Hay que regresar un error aquí.

  \end{trayectoriaAlternativa}
}
